<!DOCTYPE html>
<html>
<head>
  <style>
    #map {
      height: 75%;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    p, form {
      text-indent: 50px;
    }
  </style>
</head>
<body>

<p>Use My Location <button onclick="getLocation()">OK</button> </p>

<p><input type="text" id="address" value="">
<button onclick="convertAddress()">Search</button> </p>

<p id="url"></p>
<p id="response"></p>

<div id="map"></div>

<script>
  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition);
    } else {
      x.innerHTML = "Geolocation is not supported by this browser.";
    }
  }
  function showPosition(position) {
    //x.innerHTML = "Latitude: " + position.coords.latitude +
    //    "<br>Longitude: " + position.coords.longitude;
    initMap(position.coords.latitude, position.coords.longitude, null)
  }
</script>

<script>
  function initMap(x, y, locations) {
    var center = {lat: x, lng: y};
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 14,
      center: center
    });
    var marker, i;
    var markers = [
      {lat: x, lng: y},
      {lat: x+.01, lng: y+.01}
    ];
    for (i = 0; i < locations; i++) {
      markers.push(locations[i]);
    }
    for (i = 0; i < markers.length; i++) {
      marker = new google.maps.Marker({
        position: markers[i],
        map: map
      });
    }
  }
</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWeRVSSqyWviphBYAymUc31B2cfeZpY6A&callback=initMap">
</script>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
  function convertAddress() {
    var address = document.getElementById("address").value;
    var geocoder = new google.maps.Geocoder();

    geocoder.geocode({'address': address}, function (results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        var lat = results[0].geometry.location.lat();
        var long = results[0].geometry.location.lng();
        httpGetAsync(lat, long);
        initMap(lat, long, null);
      }
    });
  }
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script>

  function GET_REQUEST_URL(lat, lng) {
    var API_KEY = "ghbb64hj9th6yfu9dp8e6k4w";
    var BASE_URL = "http://data.tmsapi.com/v1.1/movies/showings?startDate=";

    // get the current date
    var today = new Date();
    var days = today.getDate();
    var months = today.getMonth() + 1;
    var years = today.getFullYear();

    if (days < 10)
      days = "0" + days;
    if (months < 10)
      months = "0" + months;

    // format the date string as 2016-11-03
    today = years + "-" + months + "-" + days;

    var FULL_URL = BASE_URL + today + "&lat=" + lat + "&lng=" + lng + "&api_key=" + API_KEY;
    return FULL_URL;
  }


  function displayMovieShowtimes(showtimes) {
    document.body.innerHtml += "<p>" + showtimes + "</p>";
    var x = document.getElementById("response");
    x.innerHTML = showtimes;

    /*var result = JSON.parse(showtimes);
    $(document.body).append("<pFound " + result.length + " movies showing!</p>");

    var movies = result.hits;

    var count = 0;

    $.each(result, function(index, movie) {
      var movieData = "";
      var imgsrc = thumbnails[movie.title];

      if (imgsrc == undefined)
        imgsrc = "assets/smallberg.jpg"

      movieData +='<div class="tile"><img style="height: 100%; width: 100%; object-fit: contain" src="' + imgsrc + '"><br/>';

      movieData += movie.title;
      movieData += "</div>";
      $(document.body).append(movieData);
      count++;
    });*/
  }

  function httpGetAsync(lat, lng) {
    var url = GET_REQUEST_URL(lat, lng);

    var x = document.getElementById("url");
    x.innerHTML = "URL:" + url;

    var callback = displayMovieShowtimes;
    var xmlHttp = new XMLHttpRequest();

    xmlHttp.onreadystatechange = function() {
      if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
        callback(xmlHttp.responseText);
      }
    }
    xmlHttp.open("GET", url, true);
    xmlHttp.send(null);
  }
</script>

</body>
</html>